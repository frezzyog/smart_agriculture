generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  email     String     @unique
  name      String
  password  String
  role      Role       @default(USER)
  phone     String?
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  devices   Device[]
  expenses  expenses[]
  zones     Zone[]

  @@map("users")
}

model Device {
  id         String       @id @default(uuid())
  name       String
  deviceId   String       @unique @map("device_id")
  type       DeviceType
  location   String?
  latitude   Float?
  longitude  Float?
  status     DeviceStatus @default(INACTIVE)
  userId     String       @map("user_id")
  zoneId     String?      @map("zone_id")
  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")
  alerts     Alert[]
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  zone       Zone?        @relation(fields: [zoneId], references: [id])
  pumpLogs   PumpLog[]
  sensorData SensorData[]

  @@index([userId])
  @@index([deviceId])
  @@index([zoneId])
  @@map("devices")
}

model SensorData {
  id               String   @id @default(uuid())
  deviceId         String   @map("device_id")
  temperature      Float?
  humidity         Float?
  moisture         Float?
  rain             Float?
  lightIntensity   Float?   @map("light_intensity")
  nitrogen         Float?
  phosphorus       Float?
  potassium        Float?
  pH               Float?
  ec               Float?
  soilHealth       String?  @map("soil_health")
  stressLevel      Float?   @map("stress_level")
  moistureLossRate Float?   @map("moisture_loss_rate")
  timestamp        DateTime @default(now())
  device           Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([timestamp])
  @@map("sensor_data")
}

model PumpLog {
  id          String     @id @default(uuid())
  deviceId    String     @map("device_id")
  action      PumpAction
  duration    Int?
  triggeredBy String?    @map("triggered_by")
  timestamp   DateTime   @default(now())
  device      Device     @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([timestamp])
  @@map("pump_logs")
}

model Zone {
  id                  String               @id @default(uuid())
  name                String
  userId              String               @map("user_id")
  area                Float?
  soilType            String?              @map("soil_type")
  cropType            String?              @map("crop_type")
  optimalMoisture     Float?               @map("optimal_moisture")
  irrigationRate      Float?               @map("irrigation_rate")
  dryingRate          Float?               @map("drying_rate")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  devices             Device[]
  fertilizerSchedules FertilizerSchedule[]
  irrigationSchedules IrrigationSchedule[]
  predictions         Prediction[]
  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("zones")
}

model Prediction {
  id             String         @id @default(uuid())
  zoneId         String?        @map("zone_id")
  deviceId       String?        @map("device_id")
  predictionType PredictionType @map("prediction_type")
  confidence     Float
  predictedValue Json           @map("predicted_value")
  validUntil     DateTime?      @map("valid_until")
  metadata       Json?
  createdAt      DateTime       @default(now()) @map("created_at")
  zone           Zone?          @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
  @@index([predictionType])
  @@index([createdAt])
  @@map("predictions")
}

model Alert {
  id          String     @id @default(uuid())
  deviceId    String?    @map("device_id")
  userId      String     @map("user_id")
  severity    AlertLevel
  type        AlertType
  title       String
  message     String
  isRead      Boolean    @default(false) @map("is_read")
  isDismissed Boolean    @default(false) @map("is_dismissed")
  metadata    Json?
  createdAt   DateTime   @default(now()) @map("created_at")
  readAt      DateTime?  @map("read_at")
  device      Device?    @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deviceId])
  @@index([severity])
  @@index([isRead])
  @@index([createdAt])
  @@map("alerts")
}

model Report {
  id         String     @id @default(uuid())
  userId     String     @map("user_id")
  reportType ReportType @map("report_type")
  title      String
  period     String
  startDate  DateTime   @map("start_date")
  endDate    DateTime   @map("end_date")
  data       Json
  insights   Json?
  fileUrl    String?    @map("file_url")
  createdAt  DateTime   @default(now()) @map("created_at")

  @@index([userId])
  @@index([reportType])
  @@index([period])
  @@map("reports")
}

model IrrigationSchedule {
  id            String         @id @default(uuid())
  zoneId        String         @map("zone_id")
  scheduledTime DateTime       @map("scheduled_time")
  duration      Int
  waterAmount   Float?         @map("water_amount")
  status        ScheduleStatus @default(PENDING)
  triggeredBy   String         @map("triggered_by")
  executed      Boolean        @default(false)
  executedAt    DateTime?      @map("executed_at")
  createdAt     DateTime       @default(now()) @map("created_at")
  zone          Zone           @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
  @@index([scheduledTime])
  @@index([status])
  @@map("irrigation_schedules")
}

model FertilizerSchedule {
  id               String         @id @default(uuid())
  zoneId           String         @map("zone_id")
  scheduledTime    DateTime       @map("scheduled_time")
  nitrogenAmount   Float?         @map("nitrogen_amount")
  phosphorusAmount Float?         @map("phosphorus_amount")
  potassiumAmount  Float?         @map("potassium_amount")
  status           ScheduleStatus @default(PENDING)
  triggeredBy      String         @map("triggered_by")
  executed         Boolean        @default(false)
  executedAt       DateTime?      @map("executed_at")
  createdAt        DateTime       @default(now()) @map("created_at")
  zone             Zone           @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@index([zoneId])
  @@index([scheduledTime])
  @@index([status])
  @@map("fertilizer_schedules")
}

model expenses {
  id         String   @id
  user_id    String
  title      String
  category   String
  amount     Float
  date       DateTime @default(now())
  created_at DateTime @default(now())
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([user_id])
}

enum Role {
  USER
  ADMIN
}

enum DeviceType {
  SENSOR
  PUMP
  COMBO
}

enum DeviceStatus {
  ACTIVE
  INACTIVE
  ERROR
  MAINTENANCE
}

enum PumpAction {
  ON
  OFF
  AUTO
}

enum AlertLevel {
  INFO
  WARNING
  CRITICAL
}

enum AlertType {
  MOISTURE_LOW
  MOISTURE_CRITICAL
  TEMPERATURE_HIGH
  TEMPERATURE_LOW
  PH_WARNING
  NPK_LOW
  EQUIPMENT_FAILURE
  WEATHER_ALERT
  HARVEST_READY
  SYSTEM_INFO
}

enum PredictionType {
  IRRIGATION
  FERTILIZER
  MOISTURE_FORECAST
  WEATHER
  PEST_RISK
  HARVEST_TIMING
}

enum ReportType {
  DAILY
  WEEKLY
  MONTHLY
  SEASONAL
  CUSTOM
}

enum ScheduleStatus {
  PENDING
  EXECUTING
  COMPLETED
  CANCELLED
  FAILED
}
